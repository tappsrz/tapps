<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>ABC Merge Fight</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EG9G8JFGHX"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script>
        // 获取并打印当前窗口的 URL
        const currentUrl = window.location.href;
        console.log("当前窗口的 URL:", currentUrl);
        // 初始化并获取参数
        Telegram.WebApp.ready()
        const initData = Telegram.WebApp.initDataUnsafe;
        console.log("initData:", initData);

        const startParam = initData.start_param;
        console.log("start_param:", startParam);

        let utmSource = null;
        let utmMedium = null;

        if (startParam) {
            console.log("Start parameter found:", startParam);
            const regex = /^([A-Za-z0-9]+)_(.+)$/
            const match = startParam.match(regex);

            if (match) {
                utmMedium = match[1];
                utmSource = match[2];
                console.log(`UTM Medium: ${utmMedium}`);
                console.log(`UTM Source: ${utmSource}`);
            } else {
                console.log("start_param 参数格式不匹配");
            }
        } else {
            console.log("没有 start_param 参数");
        }

        // 设置 Google Analytics 配置
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-EG9G8JFGHX', {
            'campaign_source': utmSource,
            'campaign_medium': utmMedium
        });

    </script>
</head>
<body style="margin: 0px; padding: 0px; overflow: hidden;">
    <h1>Welcome to ABC Merge Fight</h1>

    <!-- 邀请按钮 -->
    <button id="inviteButton">Invite Friends</button>
    <div id="ton-connect"></div>

    <!-- 频道按钮 -->
    <button id="channelButton">Open Channel</button>
    
    <!-- 聊天群按钮 -->
    <button id="groupButton">Open Chat Group</button>

    <!-- 邀请按钮事件 -->
    <script>
        // 邀请按钮点击事件
        document.getElementById('inviteButton').addEventListener('click', function() {
            const inviteLink = `https://t.me/share/url?url=https://t.me/ABCMergeFight_bot/game?startapp=KACAEE_sharetg&text=Join+ABC+Merge+Fight+now!`;
            Telegram.WebApp.openTelegramLink(inviteLink);
        });

        // 频道按钮点击事件
        document.getElementById('channelButton').addEventListener('click', function() {
            const channelLink = `https://t.me/IdleRestaurant`;
            Telegram.WebApp.openTelegramLink(channelLink);
        });

        // 聊天群按钮点击事件
        document.getElementById('groupButton').addEventListener('click', function() {
            const groupLink = `https://t.me/IdleRestaurantChat`;
            Telegram.WebApp.openTelegramLink(groupLink);
        });
    </script>
    <script>
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://<YOUR_APP_URL>/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });
    </script>
</body>
</html>
